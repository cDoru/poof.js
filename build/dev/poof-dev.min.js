!function(exports,global){global["true"]=exports;var module=module||{},window=window||{},document=document||{},navigator=navigator||{},poof,CONFIG,domReady,initApp;module.exports="undefined"==typeof global?window||{}:global,poof={},poof.__defineGetter__("VERSION",function(){return parseInt("0",10)}),poof.__defineGetter__("REVISION",function(){return parseInt("4",10)}),poof.__defineGetter__("BUILD",function(){return parseInt("6",10)}),poof.__defineGetter__("VERSION_STRING",function(){return poof.VERSION+"."+poof.REVISION+"."+poof.BUILD}),CONFIG={MAIN_CLASS_ATTRIBUTE_NAME:"data-main",CLASS_EXTENSION:".poof",ROOT:""},domReady=function(a){if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1);else if(/KHTML|WebKit|iCab/i.test(navigator.userAgent))var b=setInterval(function(){/loaded|complete/i.test(document.readyState)&&(a(),clearInterval(b))},10);else window.onload=a},initApp=function(){var a,b,c,d=document.getElementsByTagName("script");for(a=0;a<d.length;++a)if(d[a].hasAttribute(CONFIG.MAIN_CLASS_ATTRIBUTE_NAME)&&(b=d[a].getAttribute(CONFIG.MAIN_CLASS_ATTRIBUTE_NAME),b.match(CONFIG.CLASS_EXTENSION+"$")))return CONFIG.ROOT=-1===b.indexOf("/")?"":b.substring(0,b.lastIndexOf("/")+1),c=import$(b,function(){new c}),!0;return!1},domReady(function(){initApp()||console.warn("poof.js main class not found")}),module.exports.poof=poof;var STATIC=1,INSTANCE=2,PUBLIC=1,PROTECTED=2,PRIVATE=3,SCOPES=[{field:"static$",type:STATIC},{field:"instance$",type:INSTANCE}],ACCESSIBILITIES=[{field:"public$",type:PUBLIC},{field:"protected$",type:PROTECTED},{field:"private$",type:PRIVATE}],STRINGS={ERROR_INTERFACE_MISSING_IMPLEMENTATION:"Missing implementation of instance method {prop} in definition of class {name}",ERROR_INTERFACE_ARGUMENTS_NUM:"Number of arguments in definition of method {prop} in definition of class {name} does not match the interface",ERROR_IMPLICIT_OVERRIDE:"Illegal attempt to implicitly override method {prop} originally defined in the base class by class {name}. Overriding has to be marked explicitly by defining the new implementation within the override$ tag.",ERROR_OVERRIDE_NOT_EXISTING:"Attempt to override method {prop} that has not been defined in {class}'s base class",ERROR_OVERRIDE_PROPERTY:"Illegal attempt to override property {prop} by class {name}. Only methods can be overridden.",ERROR_OVERRIDE_STATIC:"Illegal attempt to override a static property by class {name}",ERROR_PROPERTY_REDEFINE:"Illegal attempt to redefine property {prop} by class {name}. Property already defined in the base class.",ERROR_ACCESSIBILITY_1_2:"Illegal attempt to access protected property {prop} from outside {name}'s inheritance chain",ERROR_ACCESSIBILITY_1_3:"Illegal attempt to access private property {prop} from outside class {name}",ERROR_ACCESSIBILITY_2_2:"Illegal attempt to access protected static property {prop} from outside {name}'s inheritance chain",ERROR_ACCESSIBILITY_2_3:"Illegal attempt to access private static property {prop} from outside class {name}",ERROR_CONSTANT_MODIFICATION:"Illegal attempt to modify constant property {prop} on class {name}",ERROR_CONSTANT_METHOD:"Function cannot be constant. Evaluating definition of {prop} in definition of class {class}",ERROR_EXTEND_FINAL:"Invalid attempt to extend a final class {base} by class {name}",ERROR_EXTEND_CONSTRUCTOR_EXCEPTION:"Error during establishing inheritance for class {name}. Base class constructor has raised an exception when invoked with no arguments.",ERROR_EXTEND_INVALID_TYPE:"Base class for class {name} is of invalid type",ERROR_DEFINITION_INVALID_CLASS_NAME:"Invalid class name: {name}",ERROR_DEFINITION_INVALID_CLASS_TYPE:"Invalid class type specified for class {name}",ERROR_DEFINITION_INVALID_META:"Invalid or no meta object specified for class {name}",ERROR_DEFINITION_INVALID_DEFINITION:"Invalid or no definition specified for class {name}",ERROR_DEFINITION_DUPLICATE:"Illegal attempt to redefine property {prop} on class {name}",ERROR_INSTANTIATION_DIRECT_ABSTRACT:"Illegal attempt to directly instantiate an abstract class {name}",ERROR_INSTANTIATION_DIRECT_SINGLETON:"Illegal attempt to directly instantiate a Singleton class {name}"},refIdSeed=1,constructorsById,duringSingletonInstantiation=!1,callStack=[],isInProtectedScope,isInPrivateScope,isInScope,createIdentifiableFunction,createAccessibleProperty,transcribeProperty,overrideProperty,defineClass,class$;constructorsById={},createIdentifiableFunction=function(a,b){return function(){var c;return callStack.push(a),c=b.apply(this,arguments),callStack.pop(),c}},isInProtectedScope=function(a){return 0!==callStack.length&&(a===callStack[callStack.length-1]||callStack[callStack.length-1]instanceof a.constructor)},isInPrivateScope=function(a){return 0!==callStack.length&&a===callStack[callStack.length-1]},isInScope=function(a,b){switch(b){case PROTECTED:return isInProtectedScope(a);case PRIVATE:return isInPrivateScope(a)}},createAccessibleProperty=function(a,b,c,d,e,f){switch(d){case PUBLIC:f?(a.__defineGetter__(b,function(){return c}),a.__defineSetter__(b,function(){throw new Error(STRINGS.ERROR_CONSTANT_MODIFICATION.replace("{prop}",b).replace("{name}",name))})):a[b]=c;break;case PROTECTED:case PRIVATE:a.__defineGetter__(b,function(){if(isInScope(a,d))return c;throw new Error(STRINGS["ERROR_ACCESSIBILITY_"+e.toString()+"_"+d.toString()].replace("{prop}",b).replace("{name}",name))}),f?a.__defineSetter__(b,function(){throw new Error(STRINGS.ERROR_CONSTANT_MODIFICATION.replace("{prop}",b).replace("{name}",name))}):a.__defineSetter__(b,function(c){if(!isInScope(a,d))throw new Error(STRINGS["ERROR_ACCESSIBILITY_"+e.toString()+"_"+d.toString()].replace("{prop}",b).replace("{name}",name));a.__defineGetter__(b,function(){if(isInScope(a,d))return c;throw new Error(STRINGS["ERROR_ACCESSIBILITY_"+e.toString()+"_"+d.toString()].replace("{prop}",b).replace("{name}",name))})})}},transcribeProperty=function(a,b,c,d,e,f,g){if(b!==c){if(!g&&void 0!==a[c])throw"function"==typeof a[c]?new Error(STRINGS.ERROR_IMPLICIT_OVERRIDE.replace("{prop}",c).replace("{name}",b)):new Error(STRINGS.ERROR_PROPERTY_REDEFINE.replace("{prop}",c).replace("{name}",b));if(c.toUpperCase()===c){if("function"==typeof d)throw new Error(STRINGS.ERROR_CONSTANT_METHOD.replace("{prop}",c).replace("{name}",b));createAccessibleProperty(a,c,d,e,f,!0)}else if("function"==typeof d)if(g){if(!a[c])throw new Error(STRINGS.ERROR_OVERRIDE_NOT_EXISTING.replace("{prop}",c).replace("{name}",b));var h=a[c];createAccessibleProperty(a,c,createIdentifiableFunction(a,d),e,f,!1),a[c].super$=function(){return h.apply(this,arguments)}}else createAccessibleProperty(a,c,createIdentifiableFunction(a,d),e,f,!1);else createAccessibleProperty(a,c,d,e,f,!1)}},overrideProperty=function(a,b,c,d,e){if("function"!=typeof d)throw new Error(STRINGS.ERROR_OVERRIDE_PROPERTY.replace("{prop}",c).replace("{name}",b));transcribeProperty(a,b,c,d,e,INSTANCE,!0)},defineClass=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=d&&d.extends$?d.extends$:null;if(d&&d.implements$)for(o=0;o<d.implements$.length;++o)for(p=0;p<d.implements$[o].length;++p){if(h=d.implements$[o][p],!e.instance$||!e.instance$.public$||"function"!=typeof e.instance$.public$[h.name])throw new Error(STRINGS.ERROR_INTERFACE_MISSING_IMPLEMENTATION.replace("{prop}",h.name).replace("{name}",c));if(e.instance$.public$[h.name].length!==h.length)throw new Error(STRINGS.ERROR_INTERFACE_ARGUMENTS_NUM.replace("{prop}",h.name).replace("{name}",c))}if(q){if("function"!=typeof q)throw new Error(STRINGS.ERROR_EXTEND_INVALID_TYPE.replace("{name}",c));if(q.final$)throw new Error(STRINGS.ERROR_EXTEND_FINAL.replace("{base}",q.name$).replace("{name}",c));try{b.prototype=new q}catch(r){throw new Error(STRINGS.ERROR_EXTEND_CONSTRUCTOR_EXCEPTION.replace("{name}",c)+r.toString()+"\n"+r.stack)}}for(o=0;o<SCOPES.length;++o)if(l=SCOPES[o],k=[],e[l.field])for(p=0;p<ACCESSIBILITIES.length;++p)if(m=ACCESSIBILITIES[p],e[l.field][m.field])for(i in e[l.field][m.field])if("override$"===i){if(l.type===STATIC)throw new Error(STRINGS.ERROR_OVERRIDE_STATIC.replace("{name}",c));for(j in e[l.field][m.field].override$)overrideProperty(b.prototype,c,j,e[l.field][m.field][i][j],m.type)}else{if(-1!==k.indexOf(i))throw new Error(STRINGS.ERROR_DEFINITION_DUPLICATE);transcribeProperty(l.type===STATIC?b:b.prototype,c,i,e[l.field][m.field][i],m.type,l.type),k.push(i)}if(e.instance$&&e.instance$.public$&&e.instance$.public$[c]?(f=createIdentifiableFunction(b,function(){e.instance$.public$[c].apply(this,arguments)}),q&&(f.super$=function(){q.apply(this,arguments)})):f=createIdentifiableFunction(b,function(){}),d.type$&&d.type$!==class$.PUBLIC&&d.type$!==(class$.PUBLIC|class$.FINAL))if(d.type$===class$.ABSTRACT)g=function(){throw new Error(STRINGS.ERROR_INSTANTIATION_DIRECT_ABSTRACT.replace("{name}",c))};else{if(d.type$!==class$.SINGLETON&&d.type$!==(class$.SINGLETON|class$.FINAL))throw new Error(STRINGS.ERROR_DEFINITION_INVALID_CLASS_TYPE.replace("{name}",c));var s;g=function(){if(!duringSingletonInstantiation)throw new Error(STRINGS.ERROR_INSTANTIATION_DIRECT_SINGLETON.replace("{name}",c));f.apply(this,arguments)},b.__defineGetter__("instance",function(){return s||(duringSingletonInstantiation=!0,s=new b,duringSingletonInstantiation=!1),s})}else g=function(){f.apply(this,arguments)};n=!!(d.type$&&d.type$&class$.FINAL),b.__defineGetter__("final$",function(){return n}),b.__defineGetter__("name$",function(){return c}),b.onReady$=importUtils.generateOnReadyHandler(b),constructorsById[a]=g,currentLoadPath&&(importUtils.constructorsByPath[currentLoadPath]=g,currentLoadPath=null),importUtils.notifyReady(b)},class$=function(a,b,c){var d,e,f,g;if(console.log("-- class"),"string"!=typeof a||0===a.length)throw new Error(STRINGS.ERROR_DEFINITION_INVALID_CLASS_NAME.replace("{name}",a));if("object"!=typeof b)throw new Error(STRINGS.ERROR_DEFINITION_INVALID_META.replace("{name}",a));if("object"!=typeof c)throw new Error(STRINGS.ERROR_DEFINITION_INVALID_DEFINITION.replace("{name}",a));if(currentLoadPath||(d=refIdSeed++),currentLoadPath?(e=importUtils.getResourceReference(currentLoadPath),d=e.id$):e=function(){constructorsById[d].apply(this,arguments)},e.__defineGetter__("id$",function(){return d}),e.toString=function(){return"[Class "+a+" @"+d+"]"},f=[],b.extends$&&!b.extends$.ready$&&f.push(b.extends$),b.implements$)for(g=0;g<b.implements$.length;++g)b.implements$[g].ready$||f.push(b.implements$[g]);return 0===f.length?defineClass(d,e,a,b,c):(constructorsById[d]=function(){throw new Error("Class "+a+" not ready.")},importUtils.registerDependent(e,f),e.onReady$(function(){defineClass(d,e,a,b,c)})),e},class$.PUBLIC=1,class$.ABSTRACT=2,class$.SINGLETON=4,class$.FINAL=8,module.exports.class$=class$;var interface$=function(a,b){var c,d=[];if("string"!=typeof a||0===a.length)throw new Error("Invalid interface name "+a);for(c in b){if("function"!=typeof b[c])throw new Error("An interface can only define methods. Invalid property "+a+":"+c);d.push({name:c,length:b[c].length})}return d.ready$=!0,d};module.exports.interface$=interface$;var import$,importUtils,currentLoadPath=null;importUtils={resourcesByPath:{},constructorsByPath:{},handlersByPath:{},importTimeoutId:-1,queue:[],callbacks:{},getResourceReference:function(a){return this.resourcesByPath[a]},guessResourceType:function(a){return a.match("\\.[A-Z]+.*$")?"class":a.match(".+\\.js$")?"script":a.match(".+\\.[jpg|jpeg|png]$")?"image":"other"},createReference:function(a){switch(this.guessResourceType(a)){case"class":return console.log("* class"),this.createClassReference(a);case"script":console.log("* script");break;case"image":console.log("* image");break;case"other":return console.log("* other"),{}}},createClassReference:function(a){var b,c=refIdSeed++;return this.constructorsByPath[a]=this.createTemporaryConstructor(),this.handlersByPath[a]=this.handlersByPath[a]||[],b=function(){importUtils.constructorsByPath[a].apply(this,arguments)},b.onReady$=importUtils.generateOnReadyHandler(b),b.toString=function(){return"[Import @"+c+"]"},b.__defineGetter__("id$",function(){return c}),b.__defineGetter__("path$",function(){return a}),this.resourcesByPath[a]=b,b},createTemporaryConstructor:function(){return function(){throw new Error("Class not ready yet.")}},generateOnReadyHandler:function(a){return function(b){"function"==typeof b&&(a.ready$?b():(importUtils.callbacks[a.id$]=importUtils.callbacks[a.id$]||[],-1===importUtils.callbacks[a.id$].indexOf(b)&&importUtils.callbacks[a.id$].push(b)))}},registerDependent:function(a,b){var c,d=b.length,e=function(){--d<=0&&importUtils.notifyReady(a)};if(a.__defineGetter__("ready$",function(){return!1}),a.onReady$=importUtils.generateOnReadyHandler(a),0===b.length)throw new Error("This should never happen");for(c=0;c<b.length;++c)console.log("- Waiting for dependency",b[c]),b[c].onReady$(e)},notifyReady:function(a){var b;if(!a.ready$&&(console.log("[READY]",a),currentLoadPath&&(importUtils.constructorsByPath[currentLoadPath]=function(){},currentLoadPath=null),a.__defineGetter__("ready$",function(){return!0}),importUtils.callbacks[a.id$]))for(b=0;b<importUtils.callbacks[a.id$].length;++b)"function"==typeof importUtils.callbacks[a.id$][b]&&importUtils.callbacks[a.id$][b]()},add:function(a,b,c){this.queue.push({path:a,ref:b,callback:c})},resolveUrl:function(a){return-1===a.indexOf("/")?CONFIG.ROOT+a.split(CONFIG.CLASS_EXTENSION)[0].replace(/\./g,"/")+CONFIG.CLASS_EXTENSION:a},load:function(a,b){switch(this.guessResourceType(a)){case"class":var c=a.replace(/\./g,"/")+".js";console.log("loading class",c),this.xhr(c,b);break;case"script":console.log("loading script",a);break;case"image":break;case"other":}},xhr:function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onreadystatechange=function(){4==c.readyState&&"200"==c.status&&"function"==typeof b&&b(c.responseText)}.bind(this),c.send(null)},run:function(){var a=this;clearTimeout(this.importTimeoutId),this.importTimeoutId=setTimeout(function(){a.importNext()},1)},importNext:function(){var self=this,resource,callback;0!==this.queue.length&&(resource=this.queue.splice(0,1)[0],callback=function(script){currentLoadPath=resource.path,eval(script),importUtils.notifyReady(resource.ref),"function"==typeof resource.callback&&resource.callback()},this.load(resource.path,callback))}},import$=function(a,b){var c=importUtils.getResourceReference(a);return c||(c=importUtils.createReference(a),importUtils.add(a,c,b),importUtils.run()),c},module.exports.import$=import$}({},function(){return this}());